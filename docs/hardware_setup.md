# 硬件配置说明

## 系统架构

```
┌─────────────┐    ┌──────────────┐    ┌──────────────┐
│   摄像头    │────│   K230开发板  │────│   LCD显示屏   │
└─────────────┘    │              │    └──────────────┘
                   │              │    ┌──────────────┐
┌─────────────┐    │              │────│   触摸屏     │
│   激光器    │────│              │    └──────────────┘
└─────────────┘    │              │    ┌──────────────┐
                   │              │────│   串口设备   │
                   └──────────────┘    └──────────────┘
```

## K230开发板规格

### 主要特性
- **处理器**: 双核RISC-V C908 @ 1.6GHz
- **内存**: 512MB DDR4
- **存储**: MicroSD卡槽
- **显示**: 支持MIPI DSI接口
- **摄像头**: 支持MIPI CSI接口
- **GPIO**: 丰富的GPIO引脚
- **通信**: UART、SPI、I2C等

### 引脚配置

| 功能 | 引脚号 | FPIOA功能 | 说明 |
|------|--------|-----------|------|
| UART2_TXD | 11 | FPIOA.UART2_TXD | 串口发送 |
| UART2_RXD | 12 | FPIOA.UART2_RXD | 串口接收 |
| 摄像头 | CSI接口 | CAM_CHN_ID_0 | MIPI摄像头 |
| 显示屏 | DSI接口 | ST7701驱动 | LCD显示 |
| 触摸屏 | I2C/SPI | TOUCH(0) | 电容触摸 |

## 摄像头配置

### 支持规格
- **分辨率**: 480×320 (主要), 640×480 (可选)
- **接口**: MIPI CSI
- **格式**: RGB565
- **帧率**: 15-30 FPS

### 安装要求
```python
# 初始化配置
sensor = Sensor(width=480, height=320)
sensor.reset()
sensor.set_framesize(width=480, height=320)
sensor.set_pixformat(Sensor.RGB565)
sensor.run()
```

### 推荐型号
- OV2640模块 (2MP)
- OV5640模块 (5MP)
- GC2145模块 (2MP)

## LCD显示屏配置

### 硬件规格
- **分辨率**: 800×480像素
- **接口**: MIPI DSI
- **驱动芯片**: ST7701
- **色彩**: 16位RGB565

### 初始化代码
```python
Display.init(Display.ST7701, width=800, height=480, to_ide=True)
```

### 连接说明
1. 将DSI排线连接到K230的DSI接口
2. 确保电源供应充足(3.3V/5V)
3. 检查背光控制引脚

## 触摸屏配置

### 技术规格
- **类型**: 电容式触摸屏
- **分辨率**: 与LCD同分辨率
- **接口**: I2C或SPI
- **多点**: 支持单点/多点触摸

### 初始化代码
```python
tp = TOUCH(0)  # 初始化触摸控制器
```

### 坐标映射
```python
# 触摸坐标范围: 0-800 (X轴), 0-480 (Y轴)
# 显示坐标范围: 0-480 (X轴), 0-320 (Y轴)
# 需要进行坐标转换
display_x = touch_x * 480 / 800
display_y = touch_y * 320 / 480
```

## 串口通信配置

### 硬件连接
```
K230开发板          外部设备
Pin 11 (TX) ────────→ RX
Pin 12 (RX) ←────────TX
GND        ←────────→ GND
```

### 通信参数
- **波特率**: 115200 bps
- **数据位**: 8
- **停止位**: 1
- **校验位**: None
- **流控**: None

### 初始化代码
```python
fpioa = FPIOA()
fpioa.set_function(11, FPIOA.UART2_TXD)
fpioa.set_function(12, FPIOA.UART2_RXD)
uart = UART(UART.UART2, 115200)
```

## 激光器配置

### 硬件要求
- **功率**: <1mW (安全等级)
- **波长**: 红光 (650nm) 推荐
- **供电**: 3.3V或5V
- **控制**: 可选GPIO控制开关

### 安装位置
- 激光器应安装在摄像头视野范围内
- 建议距离摄像头20-50cm
- 确保激光点在检测区域内清晰可见

### 安全注意事项
⚠️ **重要安全提醒**:
- 使用Class I或Class II激光器
- 避免直视激光光束
- 在实验环境中使用护目镜
- 确保激光功率符合安全标准

## 电源配置

### 功耗分析
| 组件 | 电压 | 电流 | 功耗 |
|------|------|------|------|
| K230开发板 | 5V | 500-800mA | 2.5-4W |
| LCD显示屏 | 3.3V/5V | 200-400mA | 1-2W |
| 摄像头 | 3.3V | 100-200mA | 0.3-0.6W |
| 激光器 | 3.3V/5V | 20-50mA | 0.1-0.25W |
| **总计** | - | - | **4-7W** |

### 供电建议
- 使用5V/2A或更高功率的电源适配器
- 确保电源纹波小于50mV
- 建议使用UPS或稳压电源

## 调试接口

### 串口调试
- **调试串口**: UART0 (默认)
- **波特率**: 115200
- **用途**: 程序调试、日志输出

### IDE连接
```python
# 启用IDE连接显示
Display.init(Display.ST7701, width=800, height=480, to_ide=True)
img.compressed_for_ide()  # 压缩图像传输到IDE
```

## 故障排除

### 摄像头问题
1. **无图像**: 检查CSI连接和供电
2. **图像模糊**: 调整焦距或清洁镜头
3. **颜色异常**: 检查像素格式设置

### 显示问题
1. **黑屏**: 检查DSI连接和背光
2. **花屏**: 检查显示时序配置
3. **颜色错误**: 验证RGB格式设置

### 触摸问题
1. **无响应**: 检查I2C连接和驱动
2. **坐标偏移**: 校准触摸参数
3. **误触**: 调整触摸灵敏度

### 串口问题
1. **无数据**: 检查TX/RX连线
2. **乱码**: 验证波特率设置
3. **丢包**: 检查信号质量和地线

## 性能优化建议

### 图像处理优化
- 使用合适的分辨率(480×320推荐)
- 优化算法参数减少计算量
- 合理使用缓存和内存

### 显示优化
- 减少不必要的绘图操作
- 使用硬件加速功能
- 优化刷新频率

### 功耗优化
- 动态调整摄像头帧率
- 优化处理器频率
- 使用睡眠模式节能